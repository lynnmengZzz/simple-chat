<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    　　<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <link rel="stylesheet" href="public/css/index.css">
    <style>
        * {
            padding: 0;
            margin: 0px;
        }
    </style>
</head>
<body>

<div class="chat_box">
    <div class="chat_box_main">
        <div class="chat_box_output">

        </div>
        <div class="chat_box_input">
            <textarea id="input" style="width: 100%;height: 100%;border: none;font-size: 20px"></textarea>
            <button class="input_button">发送</button>
        </div>
    </div>
</div>

<script>

    $(function () {

        var ws = new WebSocket("ws://127.0.0.1:9501");

        ws.onopen = function(evt) {  //绑定连接事件
            console.log("已连接到服务器");
        };

        ws.onmessage = function(evt) {//绑定收到消息事件
            console.log( "接收到来服务器的消息: " + evt.data);
            var data = JSON.parse(evt.data);
            if (data.type == 1)
            {
                $(".chat_box_output").append("<div><p class='chat_box_detail'>"+data.message+"</p></div><div style='clear:both'></div>");
            }
            else
            {
                $(".chat_box_output").append("<div><p class='chat_box_mine'>"+data.message+"</p></div><div style='clear:both'></div>");
            }
            $('.chat_box_output')[0].scrollTop =$('.chat_box_output')[0].scrollHeight;
        };

        ws.onclose = function(evt) { //绑定关闭或断开连接事件
            console.log("Connection closed.");
        };
        $('.input_button').click(function () {
            var text = $('#input').val();
            $("#input").val("").focus();
            if (text != '')
            {
                ws.send(text);
            }
        })
    })
</script>
</body>
</html>